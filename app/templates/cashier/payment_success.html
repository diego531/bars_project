<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pago Exitoso - BARS</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <div class="container d-flex justify-content-center align-items-center" style="min-height: 90vh;">
        <div class="glass-container p-5 rounded col-md-8 text-center border-success" style="border-width: 2px;">
            
            <div class="mb-4">
                <h1 class="display-4 text-success fw-bold">Â¡Pago Exitoso!</h1>
                <p class="lead text-white">El pedido <span class="badge bg-secondary">#{{ pedido.id_pedido }}</span> ha sido cerrado.</p>
                <p class="text-white-50">La <strong>Mesa {{ pedido.mesa.id_mesa }}</strong> ha sido liberada correctamente.</p>
            </div>

            <div class="card mx-auto mt-4 mb-4 text-start" style="max-width: 500px; background: rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.1);">
                <div class="card-header bg-success text-white fw-bold">
                    Resumen de la TransacciÃ³n
                </div>
                <div class="card-body text-white">
                    <!-- AQUI SE AGREGÃ“ LA FECHA -->
                    <p><strong>Fecha:</strong> <span class="float-end">{{ pedido.fecha_creacion.strftime('%d/%m/%Y %H:%M') }}</span></p>
                    <p><strong>Total Pagado:</strong> <span class="float-end">${{ '%.2f' | format(pedido.total_pedido) }}</span></p>
                    <p><strong>MÃ©todo:</strong> <span class="float-end text-capitalize">{{ pago.metodo_pago }}</span></p>
                    <p><strong>Cajero:</strong> <span class="float-end">{{ pago.cajero.nombre_completo }}</span></p>
                    
                    <hr class="border-light">

                    {% if cambio > 0 %}
                        <h4 class="text-info mb-3 text-center">Cambio Total: ${{ '%.2f' | format(cambio) }}</h4>

                        <!-- SECCIÃ“N DEL ALGORITMO VORAZ -->
                        {% if desglose %}
                            <div class="alert alert-dark border-warning bg-transparent text-white">
                                <h6 class="alert-heading fw-bold text-center mb-3 text-warning">
                                    Sugerencia de Devuelta
                                </h6>
                                <ul class="list-group list-group-flush">
                                    {% for valor, cantidad in desglose.items() %}
                                        <li class="list-group-item d-flex justify-content-between align-items-center bg-transparent text-white border-secondary">
                                            <span>
                                                {% if valor >= 2000 %}
                                                    ðŸ’µ Billetes de ${{ valor }}
                                                {% else %}
                                                    ðŸª™ Monedas de ${{ valor }}
                                                {% endif %}
                                            </span>
                                            <span class="badge bg-warning text-dark rounded-pill">{{ cantidad }}</span>
                                        </li>
                                    {% endfor %}
                                </ul>
                            </div>
                        {% endif %}
                        <!-- FIN SECCIÃ“N ALGORITMO -->

                    {% else %}
                        <p class="text-muted text-center fst-italic">No hay cambio (Pago exacto o electrÃ³nico).</p>
                    {% endif %}
                </div>
            </div>

            <div class="mt-4">
                <a href="{{ url_for('cashier.cashier_dashboard') }}" class="btn btn-lg btn-outline-light px-5">Volver al Dashboard</a>
            </div>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
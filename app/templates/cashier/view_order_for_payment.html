<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detalles Cobro - Mesa {{ mesa.id_mesa }} - BARS</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <div class="container glass-container p-4 rounded mt-4">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h1 class="h3">Pedido #{{ pedido.id_pedido }} <span class="text-muted fs-5">| Mesa {{ mesa.id_mesa }}</span></h1>
            <a href="{{ url_for('cashier.cashier_dashboard') }}" class="btn btn-outline-light btn-sm">Volver al Dashboard</a>
        </div>

        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alert alert-{{ category }} alert-dismissible fade show">
                        {{ message }}
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="alert"></button>
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        <div class="row">
            <!-- Columna Izquierda: Detalles del Pedido -->
            <div class="col-md-4 mb-4">
                <div class="card h-100" style="background: rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.1);">
                    <div class="card-header bg-dark text-white border-secondary">
                        Informaci√≥n General
                    </div>
                    <div class="card-body text-white">
                        <ul class="list-unstyled">
                            <li class="mb-2"><strong>Sede:</strong> {{ pedido.mesa.sede.nombre_sede }}</li>
                            <li class="mb-2"><strong>Mesero:</strong> {{ pedido.mesero.nombre_completo }}</li>
                            <li class="mb-2"><strong>Fecha:</strong> {{ pedido.fecha_creacion.strftime('%d/%m/%Y %H:%M') }}</li>
                            <li class="mb-2">
                                <strong>Estado:</strong> 
                                <span class="badge {{ 'bg-success' if pedido.estado == 'pagado' else 'bg-warning text-dark' }}">
                                    {{ pedido.estado.capitalize() }}
                                </span>
                            </li>
                        </ul>
                        <hr class="border-secondary">
                        <div class="text-center">
                            <small class="text-muted d-block mb-1">Total a Cobrar</small>
                            <h2 class="text-success fw-bold">${{ '%.2f' | format(pedido.total_pedido) }}</h2>
                        </div>
                    </div>
                    <div class="card-footer bg-transparent border-0">
                        {% if pedido.estado != 'pagado' and pedido.estado != 'cancelado' %}
                            <a href="{{ url_for('cashier.register_payment', pedido_id=pedido.id_pedido) }}" class="btn btn-success w-100 btn-lg">
                                Registrar Pago
                            </a>
                        {% else %}
                            <div class="alert alert-info text-center m-0 p-2">
                                Pedido cerrado
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Columna Derecha: Tabla de Productos -->
            <div class="col-md-8">
                <div class="p-3 rounded" style="background: rgba(255,255,255,0.05);">
                    <h4 class="mb-3 text-white">Productos Consumidos</h4>
                    {% if detalles %}
                        <div class="table-responsive">
                            <table class="table table-hover align-middle">
                                <thead>
                                    <tr>
                                        <th>Producto</th>
                                        <th class="text-center">Cant.</th>
                                        <th class="text-end">Unitario</th>
                                        <th class="text-end">Subtotal</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for detalle in detalles %}
                                    <tr>
                                        <td class="fw-bold">{{ detalle.producto.nombre }}</td>
                                        <td class="text-center">{{ detalle.cantidad }}</td>
                                        <td class="text-end">${{ '%.2f' | format(detalle.precio_unitario) }}</td>
                                        <td class="text-end fw-bold">${{ '%.2f' | format(detalle.subtotal) }}</td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                                <tfoot>
                                    <tr style="border-top: 2px solid rgba(255,255,255,0.2);">
                                        <td colspan="3" class="text-end text-uppercase fw-bold">Total</td>
                                        <td class="text-end fs-5 text-success">${{ '%.2f' | format(pedido.total_pedido) }}</td>
                                    </tr>
                                </tfoot>
                            </table>
                        </div>
                    {% else %}
                        <div class="alert alert-warning">Este pedido no tiene productos registrados.</div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>